<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>IAB Intent → Chrome Test</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; padding: 16px; }
    a.btn { display:inline-block; padding:12px 16px; margin:8px 0; border:1px solid #ccc; border-radius:10px; text-decoration:none; }
    .box { border:1px dashed #aaa; padding:12px; margin-top:20px; border-radius:10px; }
  </style>
</head>
<body>
  <h1>Instagram IAB → Chrome 앱 열기 테스트</h1>
  <p>아래 버튼을 클릭하면 <b>Chrome 앱</b>이 열리고 <b>google.com</b>이 뜨는지 확인해보세요.</p>

  <a class="btn" id="btn-bad" href="#">
    ❌ 상대경로 버전 (intent://./google)
  </a><br>
  <a class="btn" id="btn-good1" href="#">
    ✅ 올바른 버전 (intent://google)
  </a><br>
  <a class="btn" id="btn-good2" href="#">
    ✅ Host 명시 버전 (intent://testhost/google)
  </a>

  <div class="box" id="result">대기 중...</div>

  <script>
    const result = document.getElementById('result');
    let nav = false;
    function log(msg){ result.textContent = msg; console.log(msg); }

    // 이동 감지 (인앱 브라우저에서는 이 이벤트로 “무언가 열렸는지” 추적 가능)
    ['visibilitychange','pagehide','blur','beforeunload'].forEach(e => {
      window.addEventListener(e, () => { nav = true; log(`탐지 이벤트: ${e} → 외부 이동 추정`); }, {once:true});
    });

    function tryIntent(uri){
      nav = false;
      log(`시도 중: ${uri}`);
      setTimeout(()=>{ if(!nav) log('3초 경과: 변화 없음 → IAB가 intent 차단한 듯'); }, 3000);
      location.href = uri;
    }

    // intent URI들
    const bad = 'intent://./google#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=https%3A%2F%2Fwww.google.com;end';
    const good1 = 'intent://google#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=https%3A%2F%2Fwww.google.com;end';
    const good2 = 'intent://testhost/google#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=https%3A%2F%2Fwww.google.com;end';

    document.getElementById('btn-bad').onclick = e => { e.preventDefault(); tryIntent(bad); };
    document.getElementById('btn-good1').onclick = e => { e.preventDefault(); tryIntent(good1); };
    document.getElementById('btn-good2').onclick = e => { e.preventDefault(); tryIntent(good2); };
  </script>
</body>
</html>
